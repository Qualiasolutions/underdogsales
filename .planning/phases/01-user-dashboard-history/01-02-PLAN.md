---
phase: 01-user-dashboard-history
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/dashboard/page.tsx
  - src/components/dashboard/DashboardClient.tsx
  - src/components/dashboard/SessionHistoryCard.tsx
  - src/components/dashboard/CallHistoryCard.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to /dashboard and see the page"
    - "User can see practice sessions with date, persona name, and score"
    - "User can see call analyses with date, filename, and score"
    - "User can switch between practice sessions and call analyses tabs"
    - "User can click a session/analysis to view details"
    - "User sees friendly empty state when no history exists"
  artifacts:
    - path: "src/app/dashboard/page.tsx"
      provides: "Dashboard page (Server Component)"
      min_lines: 20
    - path: "src/components/dashboard/DashboardClient.tsx"
      provides: "Dashboard client component with tabs and lists"
      min_lines: 80
    - path: "src/components/dashboard/SessionHistoryCard.tsx"
      provides: "Practice session history card"
      min_lines: 40
    - path: "src/components/dashboard/CallHistoryCard.tsx"
      provides: "Call analysis history card"
      min_lines: 40
  key_links:
    - from: "src/app/dashboard/page.tsx"
      to: "getUserPracticeSessions"
      via: "server action import"
      pattern: "getUserPracticeSessions"
    - from: "src/app/dashboard/page.tsx"
      to: "getUserCallUploads"
      via: "server action import"
      pattern: "getUserCallUploads"
    - from: "src/components/dashboard/DashboardClient.tsx"
      to: "/practice/results/[sessionId]"
      via: "router.push on card click"
      pattern: "practice/results"
    - from: "src/components/dashboard/DashboardClient.tsx"
      to: "/analyze/[callId]"
      via: "router.push on card click"
      pattern: "analyze/"
    - from: "src/components/dashboard/SessionHistoryCard.tsx"
      to: "getPersonaById"
      via: "import for persona name lookup"
      pattern: "getPersonaById"
---

<objective>
Build the Dashboard page with practice session history and call analysis history lists.

Purpose: Users need to view their past practice sessions and call analyses in one central location with a premium, minimalistic design following the existing theme.
Output: Working dashboard page with tabbed navigation between session types, animated history cards, and empty states.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-user-dashboard-history/01-CONTEXT.md
@.planning/phases/01-user-dashboard-history/01-RESEARCH.md
@.planning/phases/01-user-dashboard-history/01-01-SUMMARY.md

# Reference patterns
@src/components/analyze/AnalysisHistory.tsx
@src/components/ui/card.tsx
@src/components/ui/badge.tsx
@src/config/personas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Dashboard page (Server Component)</name>
  <files>src/app/dashboard/page.tsx</files>
  <action>
Create `src/app/dashboard/page.tsx` as a Server Component:

1. Import server actions: `getUserPracticeSessions`, `getUserCallUploads`
2. Import DashboardClient component
3. Fetch initial data with Promise.all (both with default pagination)
4. Pass initialSessions and initialCalls to DashboardClient

Structure:
```typescript
import { getUserPracticeSessions } from '@/lib/actions/practice-session'
import { getUserCallUploads } from '@/lib/actions/call-analysis'
import { DashboardClient } from '@/components/dashboard/DashboardClient'

export const metadata = {
  title: 'Dashboard | Underdog Sales',
  description: 'View your practice history and progress',
}

export default async function DashboardPage() {
  const [sessionsResult, callsResult] = await Promise.all([
    getUserPracticeSessions({ limit: 10, offset: 0 }),
    getUserCallUploads({ limit: 10, offset: 0 }),
  ])

  return (
    <DashboardClient
      initialSessions={sessionsResult.sessions}
      initialSessionsHasMore={sessionsResult.hasMore}
      initialCalls={callsResult.uploads}
      initialCallsHasMore={callsResult.hasMore}
    />
  )
}
```

This follows the Server Component + Client Component pattern from the research.
  </action>
  <verify>
`npm run typecheck` passes for the page file.
  </verify>
  <done>
Dashboard page exists at /dashboard, fetches initial data server-side, passes to client component.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Dashboard client component with tabs</name>
  <files>
src/components/dashboard/DashboardClient.tsx
src/components/dashboard/SessionHistoryCard.tsx
src/components/dashboard/CallHistoryCard.tsx
  </files>
  <action>
**DashboardClient.tsx:**

Create the main client component with:
1. 'use client' directive
2. State: `activeTab: 'practice' | 'calls'`, loading states, pagination states
3. Tab navigation following CONTEXT.md design reference (pill-style tabs like research suggested)
4. Conditional rendering of SessionHistory or CallHistory based on tab
5. Load more functionality calling server actions with incremented offset
6. Empty states for each tab

Design patterns from CONTEXT.md:
- Navy (#021945) primary, Gold accent
- max-w-7xl container, px-6 padding
- Framer Motion animations (FadeIn, stagger)
- Premium minimalistic - Linear-style cleanliness

Tab structure:
```tsx
<div className="flex items-center gap-1 p-1 bg-muted rounded-lg w-fit">
  <button
    onClick={() => setActiveTab('practice')}
    className={cn(
      'px-4 py-2 rounded-md text-sm font-medium transition-colors',
      activeTab === 'practice'
        ? 'bg-white text-navy shadow-sm'
        : 'text-muted-foreground hover:text-navy'
    )}
  >
    <Mic className="w-4 h-4 inline mr-2" />
    Practice Sessions
  </button>
  {/* Similar for calls tab */}
</div>
```

Header section with title "Your Activity" and subtitle.

**SessionHistoryCard.tsx:**

Follow AnalysisHistory.tsx card pattern exactly:
1. motion.div with stagger animation
2. Icon with colored background (use persona-based color or consistent emerald)
3. Title: persona name (use `getPersonaById(persona_id)?.name`)
4. Meta: scenario type, duration (format: Xm Xs), date
5. Score using getScoreColor from rubric config
6. ChevronRight for clickability
7. onClick handler passed as prop

**CallHistoryCard.tsx:**

Follow AnalysisHistory.tsx card pattern:
1. Same motion animation
2. FileAudio icon with status-based colors (completed=emerald, processing=gold, failed=red)
3. Title: original_filename
4. Meta: duration, date
5. Status badge or score
6. Same click handling

Both cards need:
- `index` prop for stagger delay
- `onClick` prop for navigation
- Hover states: `hover:shadow-md hover:border-navy/20`

**Empty States:**

For each tab, show empty state when list is empty:
```tsx
<div className="text-center py-12">
  <div className="w-16 h-16 mx-auto rounded-2xl bg-muted flex items-center justify-center mb-4">
    <Icon className="w-8 h-8 text-muted-foreground" />
  </div>
  <p className="text-muted-foreground">No practice sessions yet</p>
  <p className="text-sm text-muted-foreground mt-1">
    Start your first practice to build your history
  </p>
  <Link href="/practice" className="mt-4 inline-block">
    <Button variant="primary" size="sm">
      <Mic className="w-4 h-4" />
      Start Practicing
    </Button>
  </Link>
</div>
```

Similar for calls tab pointing to /analyze.
  </action>
  <verify>
`npm run typecheck` passes. `npm run lint` passes.
  </verify>
  <done>
Dashboard shows tabbed interface with practice sessions and call analyses lists, proper empty states, and load more functionality.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete User Dashboard with:
- Dashboard link in navigation header
- Practice sessions history with persona names, scores, dates
- Call analyses history with filenames, status, scores
- Tab navigation between the two lists
- Empty states with CTAs
- Animated cards following existing design patterns
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000
3. Verify "Dashboard" link appears in navigation (between Home and Practice)
4. Click Dashboard link - should navigate to /dashboard
5. If you have practice session history:
   - Verify sessions show persona name (e.g., "Sarah Chen"), scenario type, duration, date, score
   - Click a session card - should navigate to /practice/results/[id]
6. If you have call analysis history:
   - Click "Call Analyses" tab
   - Verify analyses show filename, duration, date, score/status
   - Click a card - should navigate to /analyze/[id]
7. If no history exists:
   - Verify friendly empty state with CTA button
8. Check responsive behavior on mobile (hamburger menu should include Dashboard)
9. Verify animations are smooth and premium-feeling
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. `npm run lint` passes
3. `npm run build` succeeds
4. Dashboard accessible at /dashboard
5. Navigation includes Dashboard link
6. Both tabs work with correct data
7. Cards navigate to correct detail pages
8. Empty states render correctly
9. Animations are smooth
</verification>

<success_criteria>
- Dashboard page renders at /dashboard
- Navigation header includes Dashboard link
- Practice sessions show: persona name, scenario, duration, date, score
- Call analyses show: filename, duration, date, score/status
- Tab switching works smoothly
- Cards are clickable and navigate to detail pages
- Empty states encourage first action
- Premium minimalistic design matching existing theme
</success_criteria>

<output>
After completion, create `.planning/phases/01-user-dashboard-history/01-02-SUMMARY.md`
</output>

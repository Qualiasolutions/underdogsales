---
phase: 01-user-dashboard-history
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/dashboard/page.tsx
  - src/components/dashboard/DashboardClient.tsx
  - src/components/dashboard/SessionHistoryCard.tsx
  - src/components/dashboard/CallHistoryCard.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to /dashboard and see the page"
    - "User can see practice sessions with date, persona name, and score"
    - "User can see call analyses with date, filename, and score"
    - "User can switch between practice sessions and call analyses tabs"
    - "User can click session card and navigate to /practice/results/[id]"
    - "User can click call card and navigate to /analyze/[id]"
    - "User sees friendly empty state when no history exists"
  artifacts:
    - path: "src/app/dashboard/page.tsx"
      provides: "Dashboard page (Server Component)"
      min_lines: 20
    - path: "src/components/dashboard/DashboardClient.tsx"
      provides: "Dashboard client component with tabs and lists"
      min_lines: 80
    - path: "src/components/dashboard/SessionHistoryCard.tsx"
      provides: "Practice session history card"
      min_lines: 40
    - path: "src/components/dashboard/CallHistoryCard.tsx"
      provides: "Call analysis history card"
      min_lines: 40
  key_links:
    - from: "src/app/dashboard/page.tsx"
      to: "getUserPracticeSessions"
      via: "server action import"
      pattern: "getUserPracticeSessions"
    - from: "src/app/dashboard/page.tsx"
      to: "getUserCallUploads"
      via: "server action import"
      pattern: "getUserCallUploads"
    - from: "src/components/dashboard/DashboardClient.tsx"
      to: "/practice/results/[sessionId]"
      via: "useRouter push on card click"
      pattern: "router\\.push.*practice/results"
    - from: "src/components/dashboard/DashboardClient.tsx"
      to: "/analyze/[callId]"
      via: "useRouter push on card click"
      pattern: "router\\.push.*analyze/"
    - from: "src/components/dashboard/SessionHistoryCard.tsx"
      to: "getPersonaById"
      via: "import for persona name lookup"
      pattern: "getPersonaById"
---

<objective>
Build the Dashboard page with practice session history and call analysis history lists.

Purpose: Users need to view their past practice sessions and call analyses in one central location with a premium, minimalistic design following the existing theme.
Output: Working dashboard page with tabbed navigation between session types, animated history cards, and empty states.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-user-dashboard-history/01-CONTEXT.md
@.planning/phases/01-user-dashboard-history/01-RESEARCH.md
@.planning/phases/01-user-dashboard-history/01-01-SUMMARY.md

# Reference patterns
@src/components/analyze/AnalysisHistory.tsx
@src/components/ui/card.tsx
@src/components/ui/badge.tsx
@src/config/personas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Dashboard page (Server Component)</name>
  <files>src/app/dashboard/page.tsx</files>
  <action>
Create `src/app/dashboard/page.tsx` as a Server Component:

1. Import server actions: `getUserPracticeSessions`, `getUserCallUploads`
2. Import DashboardClient component
3. Fetch initial data with Promise.all (both with default pagination)
4. Pass initialSessions and initialCalls to DashboardClient

Structure:
```typescript
import { getUserPracticeSessions } from '@/lib/actions/practice-session'
import { getUserCallUploads } from '@/lib/actions/call-analysis'
import { DashboardClient } from '@/components/dashboard/DashboardClient'

export const metadata = {
  title: 'Dashboard | Underdog Sales',
  description: 'View your practice history and progress',
}

export default async function DashboardPage() {
  const [sessionsResult, callsResult] = await Promise.all([
    getUserPracticeSessions({ limit: 10, offset: 0 }),
    getUserCallUploads({ limit: 10, offset: 0 }),
  ])

  return (
    <DashboardClient
      initialSessions={sessionsResult.sessions}
      initialSessionsHasMore={sessionsResult.hasMore}
      initialCalls={callsResult.uploads}
      initialCallsHasMore={callsResult.hasMore}
    />
  )
}
```

This follows the Server Component + Client Component pattern from the research.
  </action>
  <verify>
`npm run typecheck` passes for the page file.
  </verify>
  <done>
Dashboard page exists at /dashboard, fetches initial data server-side, passes to client component.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DashboardClient with tabs and navigation</name>
  <files>src/components/dashboard/DashboardClient.tsx</files>
  <action>
Create the main client component with routing and state management.

**Required imports:**
```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'  // CRITICAL: from next/navigation, not next/router
import { motion } from 'framer-motion'
import { Mic, FileAudio, Loader2 } from 'lucide-react'
import Link from 'next/link'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { getUserPracticeSessions } from '@/lib/actions/practice-session'
import { getUserCallUploads } from '@/lib/actions/call-analysis'
import { SessionHistoryCard } from './SessionHistoryCard'
import { CallHistoryCard } from './CallHistoryCard'
import type { CallUpload } from '@/types'
```

**Component structure:**
1. Props interface accepting initialSessions, initialSessionsHasMore, initialCalls, initialCallsHasMore
2. State: `activeTab: 'practice' | 'calls'`, `sessions`, `sessionsHasMore`, `sessionsLoading`, `sessionsOffset`, and equivalent for calls
3. Initialize state from props

**Navigation handlers (CRITICAL):**
```typescript
const router = useRouter()

const handleSessionClick = (sessionId: string) => {
  router.push(`/practice/results/${sessionId}`)
}

const handleCallClick = (callId: string) => {
  router.push(`/analyze/${callId}`)
}
```

**Load more handlers:**
```typescript
const loadMoreSessions = async () => {
  setSessionsLoading(true)
  const newOffset = sessionsOffset + 10
  const result = await getUserPracticeSessions({ limit: 10, offset: newOffset })
  setSessions(prev => [...prev, ...result.sessions])
  setSessionsHasMore(result.hasMore)
  setSessionsOffset(newOffset)
  setSessionsLoading(false)
}
// Similar for loadMoreCalls
```

**Tab structure:**
```tsx
<div className="flex items-center gap-1 p-1 bg-muted rounded-lg w-fit">
  <button
    onClick={() => setActiveTab('practice')}
    className={cn(
      'px-4 py-2 rounded-md text-sm font-medium transition-colors',
      activeTab === 'practice'
        ? 'bg-white text-navy shadow-sm'
        : 'text-muted-foreground hover:text-navy'
    )}
  >
    <Mic className="w-4 h-4 inline mr-2" />
    Practice Sessions
  </button>
  <button
    onClick={() => setActiveTab('calls')}
    className={cn(
      'px-4 py-2 rounded-md text-sm font-medium transition-colors',
      activeTab === 'calls'
        ? 'bg-white text-navy shadow-sm'
        : 'text-muted-foreground hover:text-navy'
    )}
  >
    <FileAudio className="w-4 h-4 inline mr-2" />
    Call Analyses
  </button>
</div>
```

**Conditional list rendering:**
- If `activeTab === 'practice'`: Map sessions to SessionHistoryCard, pass `onClick={() => handleSessionClick(session.id)}`
- If `activeTab === 'calls'`: Map calls to CallHistoryCard, pass `onClick={() => handleCallClick(call.id)}`
- Pass `index` prop to each card for stagger animation

**Load more button:**
```tsx
{sessionsHasMore && (
  <Button
    variant="outline"
    onClick={loadMoreSessions}
    disabled={sessionsLoading}
    className="w-full mt-4"
  >
    {sessionsLoading ? <Loader2 className="w-4 h-4 animate-spin" /> : 'Load More'}
  </Button>
)}
```

**Header section:**
```tsx
<div className="max-w-7xl mx-auto px-6 py-8">
  <h1 className="text-3xl font-bold text-navy">Your Activity</h1>
  <p className="text-muted-foreground mt-1">Track your practice sessions and call analyses</p>
</div>
```

Design patterns from CONTEXT.md: Navy (#021945) primary, Gold accent, max-w-7xl container, px-6 padding, Framer Motion animations.
  </action>
  <verify>
`npm run typecheck` passes. Verify useRouter import is from 'next/navigation'.
  </verify>
  <done>
DashboardClient renders tabs, lists, navigation handlers (handleSessionClick routes to /practice/results/[id], handleCallClick routes to /analyze/[id]), and load more functionality.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create history card components and empty states</name>
  <files>
src/components/dashboard/SessionHistoryCard.tsx
src/components/dashboard/CallHistoryCard.tsx
  </files>
  <action>
**SessionHistoryCard.tsx:**

Follow AnalysisHistory.tsx card pattern exactly:
1. `'use client'` directive
2. motion.div with stagger animation using `index` prop: `initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: index * 0.1 }}`
3. Icon with colored background (use emerald for consistency)
4. Title: persona name using `getPersonaById(persona_id)?.name` from '@/config/personas'
5. Meta row: scenario type badge, duration (format: `${Math.floor(duration/60)}m ${duration%60}s`), relative date
6. Score display using `getScoreColor` from '@/config/rubric'
7. ChevronRight icon for clickability indication
8. onClick handler passed as prop, entire card is clickable
9. Hover states: `hover:shadow-md hover:border-navy/20 transition-all cursor-pointer`

Props interface:
```typescript
interface SessionHistoryCardProps {
  session: {
    id: string
    persona_id: string
    scenario_type: string
    duration_seconds: number
    created_at: string
    overall_score: number
  }
  index: number
  onClick: () => void
}
```

**CallHistoryCard.tsx:**

Follow same pattern:
1. Same motion animation with index prop
2. FileAudio icon with status-based colors:
   - completed: emerald background
   - processing: gold/amber background
   - failed: red background
   - pending: gray background
3. Title: `original_filename`
4. Meta: duration, date, status badge (use Badge component)
5. Score display (only if status === 'completed' and overall_score exists)
6. Same click handling and hover states

Props interface:
```typescript
interface CallHistoryCardProps {
  call: CallUpload
  index: number
  onClick: () => void
}
```

**Empty States (add to DashboardClient.tsx render):**

For practice sessions:
```tsx
{sessions.length === 0 && (
  <div className="text-center py-12">
    <div className="w-16 h-16 mx-auto rounded-2xl bg-muted flex items-center justify-center mb-4">
      <Mic className="w-8 h-8 text-muted-foreground" />
    </div>
    <p className="text-muted-foreground font-medium">No practice sessions yet</p>
    <p className="text-sm text-muted-foreground mt-1">
      Start your first practice to build your history
    </p>
    <Link href="/practice" className="mt-4 inline-block">
      <Button variant="default" size="sm">
        <Mic className="w-4 h-4 mr-2" />
        Start Practicing
      </Button>
    </Link>
  </div>
)}
```

For calls (similar, pointing to /analyze with FileAudio icon and "Upload a Call" button).
  </action>
  <verify>
`npm run typecheck` passes. `npm run lint` passes.
  </verify>
  <done>
SessionHistoryCard and CallHistoryCard render with animations, proper data display, and click handlers. Empty states show when lists are empty with CTAs.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete User Dashboard with:
- Dashboard link in navigation header
- Practice sessions history with persona names, scores, dates
- Call analyses history with filenames, status, scores
- Tab navigation between the two lists
- Empty states with CTAs
- Animated cards following existing design patterns
- Click navigation: session cards go to /practice/results/[id], call cards go to /analyze/[id]
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000
3. Verify "Dashboard" link appears in navigation (between Home and Practice)
4. Click Dashboard link - should navigate to /dashboard
5. If you have practice session history:
   - Verify sessions show persona name (e.g., "Sarah Chen"), scenario type, duration, date, score
   - Click a session card - should navigate to /practice/results/[id] (check browser URL)
6. If you have call analysis history:
   - Click "Call Analyses" tab
   - Verify analyses show filename, duration, date, score/status
   - Click a card - should navigate to /analyze/[id] (check browser URL)
7. If no history exists:
   - Verify friendly empty state with CTA button
8. Check responsive behavior on mobile (hamburger menu should include Dashboard)
9. Verify animations are smooth and premium-feeling
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. `npm run lint` passes
3. `npm run build` succeeds
4. Dashboard accessible at /dashboard
5. Navigation includes Dashboard link
6. Both tabs work with correct data
7. Cards navigate to correct detail pages (verify URLs change)
8. Empty states render correctly
9. Animations are smooth
</verification>

<success_criteria>
- Dashboard page renders at /dashboard
- Navigation header includes Dashboard link
- Practice sessions show: persona name, scenario, duration, date, score
- Call analyses show: filename, duration, date, score/status
- Tab switching works smoothly
- Session card click navigates to /practice/results/[sessionId]
- Call card click navigates to /analyze/[callId]
- Empty states encourage first action
- Premium minimalistic design matching existing theme
</success_criteria>

<output>
After completion, create `.planning/phases/01-user-dashboard-history/01-02-SUMMARY.md`
</output>

---
phase: 01-user-dashboard-history
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/header.tsx
  - src/lib/actions/practice-session.ts
  - src/lib/actions/call-analysis.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard link appears in main navigation"
    - "Server actions support pagination parameters"
    - "Pagination returns hasMore indicator"
  artifacts:
    - path: "src/components/ui/header.tsx"
      provides: "Dashboard navigation link"
      contains: "Dashboard"
    - path: "src/lib/actions/practice-session.ts"
      provides: "Paginated practice sessions"
      exports: ["getUserPracticeSessions"]
    - path: "src/lib/actions/call-analysis.ts"
      provides: "Paginated call uploads"
      exports: ["getUserCallUploads"]
  key_links:
    - from: "src/components/ui/header.tsx"
      to: "/dashboard"
      via: "Link href"
      pattern: "href.*dashboard"
---

<objective>
Add Dashboard navigation link and extend server actions with pagination support.

Purpose: Foundation for the dashboard feature - users need a way to navigate there, and the UI needs paginated data to display history lists efficiently.
Output: Updated header with Dashboard link, server actions accepting limit/offset and returning hasMore flag.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-user-dashboard-history/01-CONTEXT.md
@.planning/phases/01-user-dashboard-history/01-RESEARCH.md

@src/components/ui/header.tsx
@src/lib/actions/practice-session.ts
@src/lib/actions/call-analysis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Dashboard link to navigation</name>
  <files>src/components/ui/header.tsx</files>
  <action>
Add Dashboard to the navLinks array in header.tsx:
1. Import LayoutDashboard icon from lucide-react
2. Add new entry to navLinks array after Home: `{ href: '/dashboard', label: 'Dashboard', icon: LayoutDashboard }`

This follows the existing pattern - the navLinks array already maps to both desktop and mobile navigation automatically.
  </action>
  <verify>
Run `npm run typecheck` - no errors. Verify the icon import and navLinks update are syntactically correct.
  </verify>
  <done>
Dashboard link appears in navLinks array with LayoutDashboard icon pointing to /dashboard.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend server actions with pagination</name>
  <files>
src/lib/actions/practice-session.ts
src/lib/actions/call-analysis.ts
  </files>
  <action>
**practice-session.ts - Update `getUserPracticeSessions`:**

1. Add PaginationOptions interface:
```typescript
interface PaginationOptions {
  limit?: number
  offset?: number
}
```

2. Update function signature:
```typescript
export async function getUserPracticeSessions(
  options: PaginationOptions = {}
): Promise<{
  sessions: Array<{
    id: string
    persona_id: string
    scenario_type: string
    duration_seconds: number
    created_at: string
    overall_score: number
  }>
  hasMore: boolean
}>
```

3. Update implementation:
- Destructure: `const { limit = 10, offset = 0 } = options`
- Fetch limit + 1 records to detect hasMore
- Use `.range(offset, offset + limit)` instead of `.limit(20)`
- Return `{ sessions: data.slice(0, limit), hasMore: data.length > limit }`

**call-analysis.ts - Update `getUserCallUploads`:**

1. Add same PaginationOptions interface
2. Update function signature:
```typescript
export async function getUserCallUploads(
  options: PaginationOptions = {}
): Promise<{ uploads: CallUpload[]; hasMore: boolean }>
```

3. Update implementation:
- Destructure: `const { limit = 10, offset = 0 } = options`
- Fetch limit + 1 records
- Use `.range(offset, offset + limit)` instead of no limit
- Return `{ uploads: data.slice(0, limit).map(rowToCallUpload), hasMore: data.length > limit }`

Both functions maintain backward compatibility - default limit=10, offset=0 returns same behavior as before (just structured differently).
  </action>
  <verify>
Run `npm run typecheck` - no TypeScript errors. Both functions should accept optional pagination params and return structured response with hasMore.
  </verify>
  <done>
Both server actions accept `{ limit?, offset? }` options and return `{ sessions/uploads, hasMore }` response structure.
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. `npm run lint` passes
3. Header imports LayoutDashboard and includes Dashboard in navLinks
4. Both server actions have PaginationOptions parameter and return hasMore
</verification>

<success_criteria>
- Dashboard link added to navigation (will show once page exists)
- Server actions support pagination with limit/offset parameters
- Server actions return hasMore boolean for load-more functionality
- All TypeScript checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-user-dashboard-history/01-01-SUMMARY.md`
</output>

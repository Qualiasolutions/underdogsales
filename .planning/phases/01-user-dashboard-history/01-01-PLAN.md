---
phase: 01-user-dashboard-history
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/header.tsx
  - src/lib/actions/practice-session.ts
  - src/lib/actions/call-analysis.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard link appears in main navigation"
    - "Server actions support pagination parameters"
    - "Pagination returns hasMore indicator"
  artifacts:
    - path: "src/components/ui/header.tsx"
      provides: "Dashboard navigation link"
      contains: "Dashboard"
    - path: "src/lib/actions/practice-session.ts"
      provides: "Paginated practice sessions"
      exports: ["getUserPracticeSessions"]
    - path: "src/lib/actions/call-analysis.ts"
      provides: "Paginated call uploads"
      exports: ["getUserCallUploads"]
  key_links:
    - from: "src/components/ui/header.tsx"
      to: "/dashboard"
      via: "Link href"
      pattern: "href.*dashboard"
---

<objective>
Add Dashboard navigation link and extend server actions with pagination support.

Purpose: Foundation for the dashboard feature - users need a way to navigate there, and the UI needs paginated data to display history lists efficiently.
Output: Updated header with Dashboard link, server actions accepting limit/offset and returning hasMore flag.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-user-dashboard-history/01-CONTEXT.md
@.planning/phases/01-user-dashboard-history/01-RESEARCH.md

@src/components/ui/header.tsx
@src/lib/actions/practice-session.ts
@src/lib/actions/call-analysis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Dashboard link to navigation</name>
  <files>src/components/ui/header.tsx</files>
  <action>
Add Dashboard to the navLinks array in header.tsx:
1. Import LayoutDashboard icon from lucide-react
2. Add new entry to navLinks array after Home: `{ href: '/dashboard', label: 'Dashboard', icon: LayoutDashboard }`

This follows the existing pattern - the navLinks array already maps to both desktop and mobile navigation automatically.
  </action>
  <verify>
Run `npm run typecheck` - no errors. Verify the icon import and navLinks update are syntactically correct.
  </verify>
  <done>
Dashboard link appears in navLinks array with LayoutDashboard icon pointing to /dashboard.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend server actions with pagination</name>
  <files>
src/lib/actions/practice-session.ts
src/lib/actions/call-analysis.ts
  </files>
  <action>
**Current code structure (must understand before changing):**

`getUserPracticeSessions` currently returns `Promise<Array<{...}>>` (flat array).
`getUserCallUploads` currently returns `Promise<CallUpload[]>` (flat array).

**Required change: Wrap return in object with hasMore flag.**

**practice-session.ts - Update `getUserPracticeSessions`:**

1. Add PaginationOptions interface above the function:
```typescript
interface PaginationOptions {
  limit?: number
  offset?: number
}
```

2. Change function signature FROM:
```typescript
export async function getUserPracticeSessions(): Promise<
  Array<{
    id: string
    persona_id: string
    scenario_type: string
    duration_seconds: number
    created_at: string
    overall_score: number
  }>
>
```

TO:
```typescript
export async function getUserPracticeSessions(
  options: PaginationOptions = {}
): Promise<{
  sessions: Array<{
    id: string
    persona_id: string
    scenario_type: string
    duration_seconds: number
    created_at: string
    overall_score: number
  }>
  hasMore: boolean
}>
```

3. Update implementation:
- Add at function start: `const { limit = 10, offset = 0 } = options`
- Change `.limit(20)` to `.range(offset, offset + limit)` (fetch limit + 1 for hasMore detection)
- Change return statement from `return sessions.map(...)` to:
```typescript
const mapped = sessions.map(...)
return {
  sessions: mapped.slice(0, limit),
  hasMore: mapped.length > limit
}
```
- Change empty returns from `return []` to `return { sessions: [], hasMore: false }`

**call-analysis.ts - Update `getUserCallUploads`:**

1. Add PaginationOptions interface above the function:
```typescript
interface PaginationOptions {
  limit?: number
  offset?: number
}
```

2. Change function signature FROM:
```typescript
export async function getUserCallUploads(): Promise<CallUpload[]>
```

TO:
```typescript
export async function getUserCallUploads(
  options: PaginationOptions = {}
): Promise<{ uploads: CallUpload[]; hasMore: boolean }>
```

3. Update implementation:
- Add at function start: `const { limit = 10, offset = 0 } = options`
- Add `.range(offset, offset + limit)` to the query (after `.order()`)
- Change return from `return (data || []).map(rowToCallUpload)` to:
```typescript
const uploads = (data || []).map(rowToCallUpload)
return {
  uploads: uploads.slice(0, limit),
  hasMore: uploads.length > limit
}
```
- Change empty return from `return []` to `return { uploads: [], hasMore: false }`

**Breaking change note:** Callers expecting flat arrays will break. This is intentional - Plan 01-02 will consume the new structure.
  </action>
  <verify>
Run `npm run typecheck` - expect errors in existing callers (that's OK, they'll be updated in 01-02). Both functions should accept optional pagination params and return `{ sessions/uploads, hasMore }` structure.
  </verify>
  <done>
Both server actions accept `{ limit?, offset? }` options and return `{ sessions/uploads, hasMore }` response structure. Old flat-array return type is replaced with object wrapper.
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes (or only errors in files not modified by this plan)
2. `npm run lint` passes
3. Header imports LayoutDashboard and includes Dashboard in navLinks
4. Both server actions have PaginationOptions parameter and return hasMore
</verification>

<success_criteria>
- Dashboard link added to navigation (will show once page exists)
- Server actions support pagination with limit/offset parameters
- Server actions return hasMore boolean for load-more functionality
- All TypeScript checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-user-dashboard-history/01-01-SUMMARY.md`
</output>

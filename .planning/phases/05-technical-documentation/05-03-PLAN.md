---
phase: 05-technical-documentation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/DEPLOYMENT.md
  - docs/INTEGRATIONS.md
autonomous: true

must_haves:
  truths:
    - "Developer can deploy the application to Vercel"
    - "Developer knows all required environment variables"
    - "Developer can configure all external integrations"
  artifacts:
    - path: "docs/DEPLOYMENT.md"
      provides: "Vercel setup, env vars, Supabase config"
      min_lines: 100
    - path: "docs/INTEGRATIONS.md"
      provides: "VAPI, OpenRouter, Sentry setup guides"
      min_lines: 120
  key_links:
    - from: "docs/DEPLOYMENT.md"
      to: "docs/INTEGRATIONS.md"
      via: "Cross-references for external service setup"
      pattern: "INTEGRATIONS\\.md"
---

<objective>
Create deployment and integration documentation for the Underdog AI Sales Coach platform.

Purpose: Enable developers to deploy and configure the application with all external services.
Output: Two documentation files covering Vercel deployment and external integrations.
</objective>

<execution_context>
@/home/qualia/.claude/get-shit-done/workflows/execute-plan.md
@/home/qualia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-technical-documentation/05-RESEARCH.md

# Configuration files
@CLAUDE.md
@next.config.ts
@sentry.client.config.ts
@sentry.server.config.ts
@sentry.edge.config.ts

# Integration code
@src/lib/vapi/client.ts
@src/lib/vapi/auth.ts
@src/lib/circuit-breaker.ts
@src/config/personas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Deployment Documentation</name>
  <files>docs/DEPLOYMENT.md</files>
  <action>
Create `docs/DEPLOYMENT.md` with the following structure:

1. **Prerequisites**
   - Node.js 18+
   - npm or pnpm
   - Vercel account
   - Supabase project
   - VAPI account
   - OpenRouter account

2. **Local Development**
   ```bash
   git clone <repo>
   cd under
   npm install
   cp .env.example .env.local
   # Fill in environment variables
   npm run dev
   ```

3. **Environment Variables**

   **Required (app will not start without):**
   | Variable | Description | Where to Get |
   |----------|-------------|--------------|
   | NEXT_PUBLIC_SUPABASE_URL | Supabase project URL | Supabase Dashboard → Settings → API |
   | NEXT_PUBLIC_SUPABASE_ANON_KEY | Public anon key | Supabase Dashboard → Settings → API |
   | SUPABASE_SERVICE_ROLE_KEY | Server-side admin key | Supabase Dashboard → Settings → API |
   | NEXT_PUBLIC_VAPI_PUBLIC_KEY | VAPI public key | VAPI Dashboard → Settings |
   | VAPI_PRIVATE_KEY | VAPI private key | VAPI Dashboard → Settings |
   | VAPI_WEBHOOK_SECRET | Webhook signature secret | VAPI Dashboard → Webhooks |
   | OPENAI_API_KEY | OpenAI API key (Whisper) | OpenAI Dashboard → API Keys |
   | OPENROUTER_API_KEY | OpenRouter API key | OpenRouter Dashboard → Keys |

   **Optional (features degrade gracefully):**
   | Variable | Description | Default |
   |----------|-------------|---------|
   | NEXT_PUBLIC_SENTRY_DSN | Sentry project DSN | (error tracking disabled) |
   | NEXT_PUBLIC_SITE_URL | Production URL | https://under-eight.vercel.app |

4. **Vercel Deployment**
   - Import project from GitHub
   - Framework preset: Next.js (auto-detected)
   - Root directory: ./
   - Build command: `npm run build`
   - Install command: `npm install`
   - Output directory: .next

   **Post-deployment:**
   - Add all environment variables in Vercel Dashboard → Settings → Environment Variables
   - Enable production deployments
   - Configure custom domain (optional)

5. **Supabase Setup**
   - Create new project in Supabase
   - Run migrations: `supabase db push` or apply SQL from `supabase/migrations/`
   - Enable Row Level Security on all tables
   - Configure storage bucket `call-recordings`
   - Enable auth providers (email, optional: Google, GitHub)

6. **Database Migrations**
   - Migrations are numbered: 001_, 002_, etc.
   - Apply in order to production database
   - Use Supabase Dashboard SQL Editor or CLI
   - 10 migrations total (001-010)

7. **Troubleshooting**
   - Build errors: Check `npm run typecheck` locally first
   - Auth issues: Verify Supabase URL and anon key match
   - API errors: Check environment variables in Vercel logs
   - VAPI webhook fails: Verify VAPI_WEBHOOK_SECRET matches dashboard
  </action>
  <verify>
File exists at `docs/DEPLOYMENT.md`, has env var tables, Vercel and Supabase setup sections.
  </verify>
  <done>
DEPLOYMENT.md covers local dev, all env vars, Vercel deployment, and Supabase setup.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Integrations Documentation</name>
  <files>docs/INTEGRATIONS.md</files>
  <action>
Create `docs/INTEGRATIONS.md` with the following structure:

1. **Overview**
   - External services: VAPI, OpenRouter, OpenAI, Sentry, ElevenLabs
   - Each service has its own credentials and configuration

2. **VAPI (Voice AI)**

   **Setup:**
   - Create account at vapi.ai
   - Get API keys from Dashboard → Settings
   - Create assistants for each persona (or use existing)

   **Assistants (from personas.ts):**
   | Name | Purpose | Voice |
   |------|---------|-------|
   | Giulio Segantini | Sales coach | ElevenLabs |
   | Tony Ricci | Sales Director persona | ElevenLabs |
   | Lisa Martinez | Head of Ops persona | ElevenLabs |
   | David Park | Ops Manager persona | ElevenLabs |
   | Emily Torres | EA persona | ElevenLabs |
   | Marcus Johnson | VP Sales persona | ElevenLabs |
   | Sarah Chen | CFO persona | ElevenLabs |

   **Webhook Configuration:**
   - URL: `https://<your-domain>/api/vapi/webhook`
   - Secret: Set in VAPI_WEBHOOK_SECRET
   - Events: all enabled

   **Signature Verification:**
   - HMAC SHA-256 with timestamp
   - See `src/lib/vapi/auth.ts` for implementation

3. **OpenRouter (LLM)**

   **Setup:**
   - Create account at openrouter.ai
   - Get API key from Dashboard → Keys
   - Add credits to account

   **Model Configuration:**
   - Default: `openai/gpt-4o`
   - Fallback: Handled by circuit breaker

   **Circuit Breaker:**
   - 5 failures → open circuit
   - 30 second reset timeout
   - See `src/lib/circuit-breaker.ts`

4. **OpenAI (Whisper)**

   **Setup:**
   - Create account at platform.openai.com
   - Get API key from Dashboard → API Keys

   **Usage:**
   - Model: `whisper-1`
   - Used for: Call upload transcription
   - Max file size: 25MB (OpenAI limit)
   - Endpoint: `/api/analyze/transcribe`

5. **Sentry (Error Tracking)**

   **Setup:**
   - Create account at sentry.io
   - Create project (Next.js)
   - Get DSN from Project Settings

   **Configuration Files:**
   - `sentry.client.config.ts` - Browser error tracking
   - `sentry.server.config.ts` - Server error tracking
   - `sentry.edge.config.ts` - Edge runtime tracking

   **Features Enabled:**
   - Error tracking (all environments)
   - Session replay (production only)
   - Performance monitoring

   **Environment Variable:**
   - `NEXT_PUBLIC_SENTRY_DSN` (optional, disables Sentry if not set)

6. **ElevenLabs (Voice)**

   **Note:** ElevenLabs is integrated via VAPI, not directly.

   **Voice IDs used:**
   - Configured in VAPI assistant settings
   - Various voices for different personas
   - No direct API calls from this application

7. **Service Health**
   - Health check endpoint: `GET /api/health`
   - Checks: Supabase, OpenAI, OpenRouter connectivity
   - Response format: `{ status: 'healthy', services: {...} }`
  </action>
  <verify>
File exists at `docs/INTEGRATIONS.md`, covers VAPI, OpenRouter, OpenAI, Sentry with setup instructions.
  </verify>
  <done>
INTEGRATIONS.md covers all 5 external services with setup instructions and configuration details.
  </done>
</task>

</tasks>

<verification>
1. Both files exist in `docs/` directory
2. DEPLOYMENT.md has complete env var tables
3. INTEGRATIONS.md covers all 5 external services
4. Cross-references between docs are correct
5. `npm run build` still passes
</verification>

<success_criteria>
- [ ] docs/DEPLOYMENT.md exists with Vercel and Supabase setup
- [ ] docs/INTEGRATIONS.md exists with all external service guides
- [ ] All environment variables documented with descriptions
- [ ] VAPI assistant configuration documented
- [ ] Sentry configuration files referenced
</success_criteria>

<output>
After completion, create `.planning/phases/05-technical-documentation/05-03-SUMMARY.md`
</output>
